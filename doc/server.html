<!DOCTYPE html>
<html>
<head>
<style>
table
{
border-collapse: collapse;
}
table td, table th
{
border: 1px solid grey;
}
</style>
<title>Server - Rainback</title>
<link rel=stylesheet type=text/css href="style.css">
</head>
<body>
<main class=content>
<h1>Server - Rainback</h1>
<h2>struct parsegraph_Server</h2>
<table>
<tr><td>struct parsegraph_Connection* first_connection<td>Server's first active connection
<tr><td>struct parsegraph_Connection* last_connection<td>Server's last active connection
<tr><td>char logbuf[4096]<td>Log buffer
<tr><td>int logindex<td>Offset of log buffer's read head
<tr><td>char serverport[64]<td>Server port, copied from command-line.
<tr><td>char backendport[64]<td>Backend port, as passed from commandline.
<tr><td>const char* backendPort<td>Backend port, as passed from command-line.
<tr><td>pthread_mutex_t server_mutex<td>Server mutex. Lock before using the server.
<tr><td>volatile enum parsegraph_ServerStatus server_status<td>Server status
<tr><td>volatile int efd<td>
<tr><td>volatile int sfd<td>
<tr><td>int backendfd<td>Backend file descriptor
<tr><td>parsegraph_Connection* backend<td>Backend connection
<tr><td>pthread_t terminal_thread<td>Terminal UI thread
<tr><td>struct parsegraph_ServerModule* first_module<td>Server's first module
<tr><td>struct parsegraph_ServerModule* last_module<td>Server's last module
<tr><td>struct parsegraph_HookList hooks[parsegraph_SERVER_HOOK_MAX]<td>Server's hook list
</table>
<h2>enum parsegraph_ServerModuleEvent</h2>
<table>
<tr><td>parsegraph_EVENT_SERVER_MODULE_START,
<tr><td>parsegraph_EVENT_SERVER_MODULE_STOP
</table>

<h2>enum parsegraph_ServerHookStatus</h2>
<table>
<tr><td>parsegraph_SERVER_HOOK_STATUS_OK = 0,
<tr><td>parsegraph_SERVER_HOOK_STATUS_CLOSE = -1,
<tr><td>parsegraph_SERVER_HOOK_STATUS_COMPLETE = 1
</table>

<h2>struct parsegraph_HookEntry</h2>
<table>
<tr><td>enum parsegraph_ServerHookStatus(*hookFunc)(struct parsegraph_ClientRequest* req, void*)
<tr><td>void* hookData;
<tr><td>struct parsegraph_HookEntry* prevHook;
<tr><td>struct parsegraph_HookEntry* nextHook;
</table>

<h2>struct parsegraph_HookList</h2>
<table>
<tr><td>struct parsegraph_HookEntry* firstHook;
<tr><td>struct parsegraph_HookEntry* lastHook;
</table>

<h2>enum parsegraph_ServerHook</h2>
<table>
<tr><td>parsegraph_SERVER_HOOK_ROUTE = 0
<tr><td>parsegraph_SERVER_HOOK_WEBSOCKET = 1
<tr><td>parsegraph_SERVER_HOOK_MAX = 2
</table>

<h2>enum parsegraph_ServerStatus</h2>
<table>
<tr><td>parsegraph_SERVER_STOPPED = 0
<tr><td>parsegraph_SERVER_STARTED = 1
<tr><td>parsegraph_SERVER_WAITING_FOR_INPUT = 2
<tr><td>parsegraph_SERVER_WAITING_FOR_LOCK = 3
<tr><td>parsegraph_SERVER_PROCESSING = 4
<tr><td>parsegraph_SERVER_DESTROYING = 5
</table>

<h2>const char* parsegraph_nameServerStatus(enum parsegraph_ServerStatus)</h2>

<h2>struct parsegraph_ServerModule</h2>
<table>
<tr><td>const char* moduleDef
<tr><td>void* moduleHandle
<tr><td>void(*moduleFunc)(struct parsegraph_Server*, enum parsegraph_ServerModuleEvent)
<tr><td>struct parsegraph_ServerModule* nextModule
<tr><td>struct parsegraph_ServerModule* prevModule
</table>
<h2>void parsegraph_Server_init(struct parsegraph_Server* server)</h2>
Initializes a parsegraph_Server in the given memory.
<h2>void parsegraph_Server_invokeHook(struct parsegraph_Server* server, enum parsegraph_ServerHook serverHook, struct parsegraph_ClientRequest* req)</h2>
Runs the server's hooks for the given hook and request.
<h2>int parsegraph_Server_removeHook(struct parsegraph_Server* server, enum parsegraph_ServerHook serverHook, enum parsegraph_ServerHookStatus(*hookFunc)(struct parsegraph_ClientRequest* req, void*), void* hookData)</h2>
Removes up to one hook.
<h2>void parsegraph_Server_addHook(struct parsegraph_Server* server, enum parsegraph_ServerHook serverHook, enum parsegraph_ServerHookStatus(*hookFunc)(struct parsegraph_ClientRequest* req, void*), void* hookData)</h2>
Adds one hook.
<h2>void parsegraph_Server_log(struct parsegraph_Server* server, const char* output, size_t len)</h2>
Logs the given string to the server's log.
</main>
<nav class=toc>
<h3>Server - Rainback</h3>
<ul>
<li>struct <b>parsegraph_Server</b>
<li>enum <b>parsegraph_ServerModuleEvent</b>
<li>enum <b>parsegraph_ServerHookStatus</b>
<li>struct <b>parsegraph_HookEntry</b>
<li>struct <b>parsegraph_HookList</b>
<li>enum <b>parsegraph_ServerHook</b>
<li>enum <b>parsegraph_ServerStatus</b>
<li>const char* <b>parsegraph_nameServerStatus</b>(enum parsegraph_ServerStatus)
<li>struct <b>parsegraph_ServerModule</b>
<li>void <b>parsegraph_Server_init</b>(struct parsegraph_Server* server)
<li>void <b>parsegraph_Server_invokeHook</b>(struct parsegraph_Server* server, enum parsegraph_ServerHook serverHook, struct parsegraph_ClientRequest* req)
<li>int <b>parsegraph_Server_removeHook</b>(struct parsegraph_Server* server, enum parsegraph_ServerHook serverHook, enum parsegraph_ServerHookStatus(*hookFunc)(struct parsegraph_ClientRequest* req, void*), void* hookData)
<li>void <b>parsegraph_Server_addHook</b>(struct parsegraph_Server* server, enum parsegraph_ServerHook serverHook, enum parsegraph_ServerHookStatus(*hookFunc)(struct parsegraph_ClientRequest* req, void*), void* hookData)
<li>void <b>parsegraph_Server_log</b>(struct parsegraph_Server* server, const char* output, size_t len)
</ul>
</nav>
</body>
</html>
