<!DOCTYPE html>
<html>
<head>
<style>
table
{
border-collapse: collapse;
}
table td, table th
{
border: 1px solid grey;
}
</style>
</head>
<body>
<h1>Rainback reverse proxy server</h1>
<table>
<tr><td>Request URI parsing, to determine host information.
<tr><td>Method and request header handling
</table>
<h2>Request headers</h2>
<h3><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.1">Accept</a></h3>
Accept-Charset ... 14.2
Accept-Encoding ... 14.3
Accept-Language ... 14.4
Accept-Ranges ... 14.5
Age ... 14.6
Allow ... 14.7
Authorization ... 14.8
Cache-Control ... 14.9
What is Cacheable ... 14.9.1
What May be Stored by Caches ... 14.9.2
Modifications of the Basic Expiration Mechanism ... 14.9.3
Cache Revalidation and Reload Controls ... 14.9.4
No-Transform Directive ... 14.9.5
Cache Control Extensions ... 14.9.6
Connection ... 14.10
Content-Encoding ... 14.11
Content-Language ... 14.12
Content-Length ... 14.13
Content-Location ... 14.14
Content-MD5 ... 14.15
Content-Range ... 14.16
Content-Type ... 14.17
Date ... 14.18
Clockless Origin Server Operation ... 14.18.1
ETag ... 14.19
Expect ... 14.20
Expires ... 14.21
From ... 14.22
Host ... 14.23
If-Match ... 14.24
If-Modified-Since ... 14.25
If-None-Match ... 14.26
If-Range ... 14.27
If-Unmodified-Since ... 14.28
Last-Modified ... 14.29
Location ... 14.30
Max-Forwards ... 14.31
Pragma ... 14.32
Proxy-Authenticate ... 14.33
Proxy-Authorization ... 14.34
Range ... 14.35
Byte Ranges ... 14.35.1
Range Retrieval Requests ... 14.35.2
Referer ... 14.36
Retry-After ... 14.37
Server ... 14.38
TE ... 14.39
Trailer ... 14.40
Transfer-Encoding ... 14.41
Upgrade ... 14.42
User-Agent ... 14.43
Vary ... 14.44
Via ... 14.45
Warning ... 14.46
WWW-Authenticate ... 14.47
<h3>parsegraph_Backend_connect(int fd)</h3>
Connects to the specified backend.
<table>

<h3>struct parsegraph_Connection</h3>
<p>
A generic connection.
</p>
<tr><td>fd<td>Polled file descriptor.</tr>
<tr><td>shouldDestroy<td>Nonzero if this connection should be destroyed upon return to the event loop.</tr>
<tr><td>wantsWrite<td>Nonzero if the connection needs write to the polled file descriptor.</tr>
<tr><td>wantsRead<td>Nonzero if the connection needs read to the polled file descriptor.</tr>
<tr><td>poll<td>The <a href="https://linux.die.net/man/7/epoll">epoll_event</a> queue.</tr>

<tr><td>buf[parsegraph_BUFSIZE]<td>The buffer.</tr>
<tr><td>bufsize<td>The size of the buffer.</tr>
<tr><td>bufhead<td>The position at which data is read into the buffer.</tr>

<tr><td>writeBuf[parsegraph_BUFSIZE]<td>The buffer.</tr>
<tr><td>writeBufSize<td>The size of the buffer.</tr>
<tr><td>writeBufReadHead<td>The position at which data is read from the buffer.</tr>
<tr><td>writeBufWriteHead<td>The position at which data is written into the buffer.</tr>

<tr><td>type<td>Either parsegraph_ConnectionNature_BACKEND or parsegraph_ConnectionNature_CLIENT</tr>
<tr><td>nature<td>Union of either a struct ClientNature .client or struct BackendNature .backend</tr>
</table>
<h3>struct ClientNature</h3>
<p>
Connection nature used for secured client connections.
</p>
<table>
<tr><td>ctx<td>Pointer to a SSL_CTX OpenSSL context.</tr>
<tr><td>ssl<td>Pointer to SSL OpenSSL connection.</tr>
<tr><td>stage<td>A parsegraph_ClientStage indicating the stage of the client request.</tr>
<tr><td>current_request<td>The first request to be written.</tr>
<tr><td>latest_request<td>The last request received.</tr>
<tr><td>requests_in_process<td>The number of requests in [current_request, latest_request].</tr>
</table>
<h3>struct parsegraph_ClientRequest</h3>
<p>
</p>
<table>
<tr><td>uri<td>A null-terminated string representing the HTTP request URI.</tr>
<tr><td>method<td>A null-terminated string representing the HTTP request method.</tr>
</table>
<h3>enum parsegraph_ClientStage</h3>
Indicates the stage of the request. Used for reentrant processing.
<ol>
<li>parsegraph_CLIENT_ACCEPTED
<li>parsegraph_CLIENT_SECURED
<li>parsegraph_CLIENT_PROXIED
<li>parsegraph_CLIENT_REQUEST_LINE_READ
<li>parsegraph_CLIENT_REQUEST_HEADERS_READ
<li>parsegraph_CLIENT_COMPLETE
</ol>
<h3>struct BackendNature</h3>
Connection nature used for worker connections to backend servers.
<p>
In practice, this nature will be given a connection to read from. This must include an
in-memory request header, followed by a streamed request body.
<table>
<tr><td><td>
</table>
<h3>enum parsegraph_BackendStage</h3>
Indicates the stage of the request. Used for reentrant processing.
<ol>
<li>parsegraph_SERVER_CONNECTED
<li>parsegraph_SERVER_COMPLETE
</ol>
</body>
</html>
