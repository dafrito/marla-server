<!DOCTYPE html>
<html>
<head>
<style>
table
{
border-collapse: collapse;
}
table td, table th
{
border: 1px solid grey;
}
</style>
<title>Server - Marla</title>
<link rel=stylesheet type=text/css href="../../doc/rainback.css">
</head>
<body>
	<div class="grid">
		<div class="logo">
		<nav class="toc" style="clear: none">
		<p style="text-align: center">
		<a href=/><img id=logo src="../../doc/nav-side-logo.png"></img></a>
		</p>
		</nav>
		</div>
		<div class="block title">
		<h1><h1>Server- <a href="index.html">Marla</a></h1>
		<h1>Marla Server</h1>
		</div>

		<div class="slot toctitle">
		<h2>Table of Contents</h2>
		<div class="cot" style="font-size: 10px">
		<h3>Marla</h3>
		Marla is a HTTP 1.1 server that requires <a href="https://apr.apache.org/">APR		</a>, <a href="https://www.openssl.org/">OpenSSL</a>, and <a href="		http://invisible-island.net/ncurses/">ncurses</a>. Marla is written to work on 		Linux 2.6.17 or greater. Marla is licensed under the <a href="		http://www.apache.org/licenses/LICENSE-2.0">Apache License, version 2.0</a>.
		
		<ol style="font-size: 10px ; padding-left: 0em ; text-align: center" id="top-links">
		<li><a href="main.html">Main </a>
		<li><a href="server.html">Server </a>
		<li><a href="connection.html">Connection </a>
		<li><a href="request.html">Request </a>
		<li><a href="ChunkedPageRequest.html">ChunkedPageRequest </a>
		<li><a href="backend.html">Backend </a>
		<li><a href="ring.html">Ring </a>
		</ol>
		</nav>
		<h3>Server - <a href="index.html">Marla</a></h3>
		<ul>
		<li>struct <b><a href="#marla_Server">marla_Server</a></b>
		<li>enum <b><a href="#marla_ServerHookStatus">marla_ServerHookStatus</a></b>
		<li>struct <b><a href="#marla_HookEntry">marla_HookEntry</a></b>
		<li>struct <b><a href="#marla_HookList">marla_HookList</a></b>
		<li>enum <b><a href="#marla_ServerHook">marla_ServerHook</a></b>
		<li>enum <b><a href="#marla_ServerStatus">marla_ServerStatus</a></b>
		<li>enum <b><a href="#marla_ServerModuleEvent">marla_ServerModuleEvent</a></b>
		<li>struct <b><a href="#marla_ServerModule">marla_ServerModule</a></b>
		<li>void <b><a href="#marla_Server_init">marla_Server_init</a></b>(marla_Server* server)
		<li>void <b><a href="#marla_Server_free">marla_Server_free</a></b>(marla_Server* server)
		<li>void <b><a href="#marla_Server_invokeHook">marla_Server_invokeHook</a></b>(marla_Server* server, enum marla_ServerHook 		serverHook, struct marla_ClientRequest* req)
		<li>void <b><a href="#marla_Server_addHook">marla_Server_addHook</a></b>(marla_Server* server,<br/>enum 	marla_ServerHook 	serverHook,<br/>enum 	marla_ServerHookStatus(*hookFunc)(marla_ClientRequest* req, void*),	<br/>void* 	hookData)
		<li>int <b><a href="#marla_Server_removeHook">marla_Server_removeHook</a></b>(marla_Server* server,<br/>enum 	marla_ServerHook 	serverHook,<br/>enum marla_ServerHookStatus(*hookFunc)(struct 	marla_ClientRequest* req, 	void*),<br/>void* hookData)
		<li>void <b><a href="#marla_die">marla_die</a></b>(marla_Server* server, const char* fmt, ...)</li>
		<li>void <b><a href="#marla_Server_flushLog">marla_Server_flushLog</a></b>(struct marla_Server* server)
		<li>void <b><a href="#marla_logEntercf">marla_logEntercf</a></b>(marla_Server* server, const char* category, const 		char* fmt, ...)
		<li>void <b><a href="#marla_logEnterc">marla_logEnterc</a></b>(marla_Server* server, const char* category, const 	char* 	message)
		<li>void <b><a href="#marla_logEnter">marla_logEnter</a></b>(marla_Server* server, const char* message)
		<li>void <b><a href="#marla_logEnterf">marla_logEnterf</a></b>(marla_Server* server, const char* fmt, ...)
		<li>void <b><a href="#marla_logLeave">marla_logLeave</a></b>(marla_Server* server, const char* message)
		<li>void <b><a href="#marla_logLeavec">marla_logLeavec</a></b>(marla_Server* server, const char* category, const 	char* 	message)
		<li>void <b><a href="#marla_logLeavef">marla_logLeavef</a></b>(marla_Server* server, const char* fmt, ...)
		<li>void <b><a href="#marla_logReset">marla_logReset</a></b>(marla_Server* server, const char* message)
		<li>void <b><a href="#marla_logResetc">marla_logResetc</a></b>(marla_Server* server, const char* category, const 	char* 	message)
		<li>void <b><a href="#marla_logMessagec">marla_logMessagec</a></b>(marla_Server* server, const char* category, const 		char* message)
		<li>void <b><a href="#marla_logMessage">marla_logMessage</a></b>(marla_Server* server, const char* message)
		<li>void <b><a href="#marla_logMessagecf">marla_logMessagecf</a></b>(marla_Server* server, const char* category, 	const 	char* fmt, ...)
		<li>void <b><a href="#marla_logMessagef">marla_logMessagef</a></b>(marla_Server* server, const char* fmt, ...)
		<li>const char* <b><a href="#marla_nameServerStatus">marla_nameServerStatus</a></b>(enum marla_ServerStatus)
		<li>#define <b><a href="#marla_LOGBUFSIZE">marla_LOGBUFSIZE</a></b>
		</ul>
		</div>
		</div>

		<div class="block linksearch" style="font-size: 15px">
			<div class=links>
       <form id=search action="/search">
        <input name=q></input> <input type=submit value=Search></input>
        </form>
        <a href=/login><span class="bud" style="background-color: greenyellow">Log in</span></a> 
        <a href=/signup><span class="bud" style="background-color: gold">Sign up</span></a> 
        <a href="/import"><span class="bud" style="align-content: right">Import</span></a>
    	</div>
		</div>
		
		<div class="block content" style="font-size: 15px"> 
		
		<h1>Server - <a href="index.html">Marla</a></h1>
		Global context.
		<h2>struct <a name="marla_Server">marla_Server</h2></a>
		<table>
		<tr><td>struct marla_Connection* first_connection<td>Server's first active 	connection
		<tr><td>struct marla_Connection* last_connection<td>Server's last active connection
		<tr><td>marla_Ring* log<td>Log buffer
		<tr><td>char logaddress[1024]<td>TCP URL of the logging server
		<tr><td>int using_ssl<td>1 if this server is using TLS encryption for its 	connections.
		<tr><td>int logfd<td>Logging file descriptor
		<tr><td>char serverport[64]<td>Server port, copied from command-line.
		<tr><td>char backendport[64]<td>Backend port, as passed from commandline.
		<tr><td>const char* backendPort<td>Backend port, as passed from command-line.
		<tr><td>pthread_mutex_t server_mutex<td>Server mutex. Lock before using the server.
		<tr><td>volatile enum marla_ServerStatus server_status<td>Server status
		<tr><td>volatile int efd<td>
		<tr><td>volatile int sfd<td>
		<tr><td>int backendfd<td>Backend file descriptor
		<tr><td>marla_Connection* backend<td>Backend connection
		<tr><td>pthread_t terminal_thread<td>Terminal UI thread
		<tr><td>struct marla_ServerModule* first_module<td>Server's first module
		<tr><td>struct marla_ServerModule* last_module<td>Server's last module
		<tr><td>struct marla_HookList hooks[marla_SERVER_HOOK_MAX]<td>Server's hook list
		</table>
		<h2>enum <a name="marla_ServerHookStatus">marla_ServerHookStatus</h2></a>
		<table>
		<tr><td>marla_SERVER_HOOK_STATUS_OK = 0,
		<tr><td>marla_SERVER_HOOK_STATUS_CLOSE = -1,
		<tr><td>marla_SERVER_HOOK_STATUS_COMPLETE = 1
		</table>
		
		<h2>struct <a name="marla_HookEntry">marla_HookEntry</h2></a>
		<table>
		<tr><td>enum marla_ServerHookStatus(*hookFunc)(struct marla_ClientRequest* req, 	void*)
		<tr><td>void* hookData;
		<tr><td>struct marla_HookEntry* prevHook;
		<tr><td>struct marla_HookEntry* nextHook;
		</table>
		
		<h2>struct <a name="marla_HookList">marla_HookList</h2></a>
		<table>
		<tr><td>struct marla_HookEntry* firstHook;
		<tr><td>struct marla_HookEntry* lastHook;
		</table>
		
		<h2>enum <a name="marla_ServerHook">marla_ServerHook</h2></a>
		<table>
		<tr><td>marla_SERVER_HOOK_ROUTE = 0<td>Invoked once the request's line has been read
		<tr><td>marla_SERVER_HOOK_WEBSOCKET = 1<td>Allows hooks to change the handler when 		WebSocket is being used.
		<tr><td>marla_SERVER_HOOK_MAX = 2<td>Constant to indicate the end of hook names.
		</table>
		
		<h2>enum <a name="marla_ServerStatus">marla_ServerStatus</h2></a>
		<table>
		<tr><td>marla_SERVER_STOPPED = 0
		<tr><td>marla_SERVER_STARTED = 1
		<tr><td>marla_SERVER_WAITING_FOR_INPUT = 2
		<tr><td>marla_SERVER_WAITING_FOR_LOCK = 3
		<tr><td>marla_SERVER_PROCESSING = 4
		<tr><td>marla_SERVER_DESTROYING = 5
		</table>
		
		
		<h2>enum <a name="marla_ServerModuleEvent">marla_ServerModuleEvent</h2></a>
		<table>
		<tr><td>marla_EVENT_SERVER_MODULE_START,
		<tr><td>marla_EVENT_SERVER_MODULE_STOP
		</table>
		
		<h2>struct <a name="marla_ServerModule">marla_ServerModule</h2></a>
		<table>
		<tr><td>const char* moduleDef
		<tr><td>void* moduleHandle
		<tr><td>void(*moduleFunc)(marla_Server*, enum marla_ServerModuleEvent)
		<tr><td>struct marla_ServerModule* nextModule
		<tr><td>struct marla_ServerModule* prevModule
		</table>
		<h2>void <a name="marla_Server_init">marla_Server_init(marla_Server* server)</h2></a>
		Initializes a marla_Server in the given memory.
		<h2>void <a name="marla_Server_free">marla_Server_free(struct marla_Server* server)</h2></a>
		Frees the marla_Server structures at the given location. The server pointer object 	is 	not freed.
		<h2>void <a name="marla_Server_invokeHook">marla_Server_invokeHook(marla_Server* server, enum marla_ServerHook 		serverHook, marla_ClientRequest* req)</h2></a>
		Runs the server's hooks for the given hook and request.
		<h2>void <a name="marla_Server_addHook">marla_Server_addHook(marla_Server* server,<br/>enum marla_ServerHook 		serverHook,<br/>enum marla_ServerHookStatus(*hookFunc)(marla_ClientRequest* req, 	void*),	<br/>void* hookData)</h2></a>
		Adds one hook.
		<h2>int <a name="marla_Server_removeHook">marla_Server_removeHook(marla_Server* server,<br/>enum marla_ServerHook 		serverHook,<br/>enum marla_ServerHookStatus(*hookFunc)(marla_ClientRequest* req, 	void*),	<br/>void* hookData)</h2></a>
		Removes up to one hook.
		<h2>void <a name="marla_die">marla_die(marla_Server* server, const char* fmt, ...)</h2></a>
		Aborts the server with the given error message. This function does not return.
		<h2>void <a name="marla_Server_flushLog">marla_Server_flushLog(struct marla_Server* server)</h2></a>
		Flushes the server's log output.
		<h2>void <a name="marla_logEntercf">marla_logEntercf(marla_Server* server, const char* category, const char* 	fmt, 	...)</h2></a>
		Logs the categorized and formatted message.
		<h2>void <a name="marla_logEnterc">marla_logEnterc(marla_Server* server, const char* category, const char* 		message)</h2></a>
		Logs the categorized message.
		<h2>void <a name="marla_logEnter">marla_logEnter(marla_Server* server, const char* message)</h2></a>
		Enters a logging node with the given message.
		<h2>void <a name="marla_logEnterf">marla_logEnterf(marla_Server* server, const char* fmt, ...)</h2></a>
		Enters a logging node with the given formatted message.
		<h2>void <a name="marla_logLeave">marla_logLeave(marla_Server* server, const char* message)</h2></a>
		Leaves a logging node. Message, if given, is added to the logging node before 	leaving.
		<h2>void <a name="marla_logLeavec">marla_logLeavec(marla_Server* server, const char* category, const char* 		message)</h2></a>
		Leaves a logging node. The categorized message, if given, is added to the logging 	node 	before leaving.
		<h2>void <a name="marla_logLeavef">marla_logLeavef(marla_Server* server, const char* fmt, ...)</h2></a>
		Leaves a logging node. Message, if given, is added to the logging node before 	leaving.
		<h2>void <a name="marla_logReset">marla_logReset(marla_Server* server, const char* message)</h2></a>
		Resets logging output, leaving all logging nodes. The message is added to the root 	if 	non-null.
		<h2>void <a name="marla_logResetc">marla_logResetc(marla_Server* server, const char* category, const char* 		message)</h2></a>
		Resets logging output, leaving all logging nodes. The categorized message is added 	to 	the root if non-null.
		<h2>void <a name="marla_logMessagec">marla_logMessagec(marla_Server* server, const char* category, const char* 		message)</h2></a>
		Adds a logging node with the given categorized message.
		<h2>void <a name="marla_logMessage">marla_logMessage(marla_Server* server, const char* message)</h2></a>
		Adds a logging node with the given message.
		<h2>void <a name="marla_logMessagecf">marla_logMessagecf(marla_Server* server, const char* category, const char* 		fmt, ...)</h2></a>
		Adds a logging node with the given categorized message.
		<h2>void <a name="marla_logMessagef">marla_logMessagef(marla_Server* server, const char* fmt, ...)</h2></a>
		Adds a logging node with the given formatted message.
		<h2>const char* <a name="marla_nameServerStatus(enum marla_ServerStatus">marla_nameServerStatus(enum marla_ServerStatus)</h2></a>
		<h2>#define <a name="marla_LOGBUFSIZE">marla_LOGBUFSIZE</h2></a>
		The size of the server's log buffer, in bytes. Defined as 32*1024.
		</div>

		<div class="footer slot" style="display: inline-block; ">
    	&copy; 2018 <a href='https://rainback.com'>Rainback, Inc.</a> All rights reserved. <a href=/contact><span class="bud">Contact Us</span></a>
		</div>
	</div>
	</div>	
</body>
</html>
